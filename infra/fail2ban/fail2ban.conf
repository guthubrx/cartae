#
# Fail2ban Configuration for Cartae
# Session 81g - Incident Response & Security Operations
#
# This file configures the core Fail2ban daemon for protecting
# Cartae API endpoints against brute force attacks, authentication
# failures, and port scanning attempts.
#

[Definition]

# Niveau de logging (CRITICAL, ERROR, WARNING, NOTICE, INFO, DEBUG)
# Production: WARNING pour éviter log spam
loglevel = WARNING

# Fichier de log Fail2ban
logtarget = /var/log/fail2ban.log

# Socket pour communication client/serveur
socket = /var/run/fail2ban/fail2ban.sock

# PID file
pidfile = /var/run/fail2ban/fail2ban.pid

# Database pour persistance des bans
# Type: None | memory | file
dbfile = /var/lib/fail2ban/fail2ban.sqlite3
dbpurgeage = 86400

[Thread]

# Stack trace size (debug)
stacksize = 0

[DEFAULT]

# Ignorer les IPs locales et réseaux de confiance
# Format: 127.0.0.1/8 ou liste séparée par espaces
ignoreip = 127.0.0.1/8 ::1 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16

# Durée de ban par défaut (secondes)
# 1 heure = 3600s
bantime = 3600

# Fenêtre de détection (secondes)
# Compte les tentatives sur cette période
findtime = 600

# Nombre max de tentatives avant ban
maxretry = 5

# Backend pour surveillance des logs
# auto | pyinotify | gamin | polling | systemd
backend = auto

# Action par défaut quand ban détecté
# Voir /etc/fail2ban/action.d/ pour liste complète
# %(action_)s = ban seulement
# %(action_mw)s = ban + email avec whois
# %(action_mwl)s = ban + email avec whois + log lines
banaction = iptables-multiport
banaction_allports = iptables-allports

# Protocole réseau
protocol = tcp

# Chaîne iptables pour les bans
chain = INPUT

# MTA pour notifications email (si action avec email)
mta = sendmail

# Action par défaut (juste ban, pas d'email)
action = %(action_)s

[Logging]

# Rotation des logs Fail2ban
# Taille max avant rotation
maxsize = 10485760

# Nombre de fichiers de backup
backupcount = 5

# Compression des anciens logs
compress = true

# SYSLOG options (si logtarget = SYSLOG)
# Facility: KERN, USER, MAIL, DAEMON, AUTH, LPR, NEWS, UUCP, CRON, SYSLOG, LOCAL0-7
# Target: hostname:port ou /path/to/socket
syslogsocket = auto
syslogfacility = 1

# Permissions
# File mode pour les fichiers créés (logs, db)
filemode = 0640

# User/Group propriétaires
# Si vide, utilise user/group du processus
# owner = fail2ban
# group = fail2ban

[Communication]

# Serveur Fail2ban peut être contacté via socket
# Utile pour fail2ban-client
enabled = true
